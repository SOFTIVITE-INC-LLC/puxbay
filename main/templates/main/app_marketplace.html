{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}App Marketplace - Puxbay{% endblock %}
{% block page_title %}App Marketplace{% endblock %}

{% block content %}
<div class="space-y-12">
    <!-- Hero / Featured Banner -->
    <div class="relative rounded-3xl overflow-hidden bg-indigo-600 p-8 sm:p-12 text-white shadow-2xl shadow-indigo-200 dark:shadow-none">
        <div class="relative z-10 max-w-2xl">
            <span class="inline-block px-3 py-1 bg-white/20 rounded-full text-[10px] font-black uppercase tracking-widest mb-4">Official Marketplace</span>
            <h2 class="text-4xl font-black mb-4 tracking-tight">Expand your POS powers.</h2>
            <p class="text-indigo-100 text-lg leading-relaxed">
                Connect Puxbay to your favorite tools. From automated accounting to advanced marketing, our certified partners help you grow faster.
            </p>
        </div>
        
        <!-- Background Decoration -->
        <div class="absolute right-0 top-0 w-1/3 h-full opacity-10 hidden lg:block">
            <span class="material-symbols-outlined" style="font-size: 240px; transform: rotate(15deg) translate(20px, -20px);">apps</span>
        </div>
        
        <!-- Abstract Glass Circles -->
        <div class="absolute -bottom-20 -right-20 w-80 h-80 bg-white/10 rounded-full blur-3xl"></div>
    </div>

    <!-- App Categories / Filters (Placeholders for future) -->
    <div class="flex gap-4 overflow-x-auto pb-4 scrollbar-hide">
        <button class="px-6 py-2 bg-indigo-600 text-white rounded-full font-bold text-sm whitespace-nowrap shadow-lg shadow-indigo-600/20">All Apps</button>
        <button class="px-6 py-2 bg-white text-slate-600 rounded-full font-bold text-sm whitespace-nowrap border border-slate-200 hover:bg-slate-50 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400">Inventory</button>
        <button class="px-6 py-2 bg-white text-slate-600 rounded-full font-bold text-sm whitespace-nowrap border border-slate-200 hover:bg-slate-50 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400">Accounting</button>
        <button class="px-6 py-2 bg-white text-slate-600 rounded-full font-bold text-sm whitespace-nowrap border border-slate-200 hover:bg-slate-50 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400">Marketing</button>
        <button class="px-6 py-2 bg-white text-slate-600 rounded-full font-bold text-sm whitespace-nowrap border border-slate-200 hover:bg-slate-50 transition-all dark:bg-slate-800 dark:border-slate-700 dark:text-slate-400">Reports</button>
    </div>

    <!-- Apps Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
        {% for app in public_apps %}
        <div class="group bg-white rounded-3xl p-8 border border-slate-200 shadow-sm transition-all hover:shadow-xl hover:border-indigo-200 hover:-translate-y-1 relative dark:bg-slate-800 dark:border-slate-700 dark:hover:border-indigo-500/50">
            <!-- Connection Status Badge -->
            {% if app.id in connected_system_ids %}
            <div class="absolute top-6 right-6 flex items-center gap-1.5 px-3 py-1 bg-green-50 text-green-700 text-[10px] font-black rounded-full uppercase tracking-widest dark:bg-green-900/30 dark:text-green-400">
                <span class="w-1.5 h-1.5 rounded-full bg-green-600 animate-pulse"></span>
                Connected
            </div>
            {% endif %}

            <div class="w-16 h-16 rounded-2xl bg-indigo-50 text-indigo-600 flex items-center justify-center mb-6 transition-transform group-hover:scale-110 dark:bg-indigo-900/30 dark:text-indigo-400">
                <span class="material-symbols-outlined text-3xl">{{ app.icon|default:"rocket_launch" }}</span>
            </div>

            <h3 class="text-xl font-black text-slate-900 mb-2 dark:text-white">{{ app.name }}</h3>
            <p class="text-slate-500 text-sm leading-relaxed mb-8 line-clamp-3">
                {{ app.description|default:"No description provided for this integration." }}
            </p>

            <div class="flex items-center justify-between pt-6 border-t border-slate-100 dark:border-slate-700">
                <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                    By {{ app.developer.name }}
                </div>
                
                {% if app.id in connected_system_ids %}
                    <button disabled class="px-6 py-2 bg-slate-100 text-slate-400 rounded-xl font-bold text-sm dark:bg-slate-700">
                        Installed
                    </button>
                {% else %}
                    <form action="{% url 'app_connect' app.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="px-6 py-2 bg-slate-900 hover:bg-indigo-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-slate-900/10 transition-all flex items-center gap-2">
                            Connect
                            <span class="material-symbols-outlined text-xs">arrow_forward</span>
                        </button>
                    </form>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="col-span-full py-24 text-center">
            <div class="w-24 h-24 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 dark:bg-slate-800">
                <span class="material-symbols-outlined text-4xl text-slate-300">work_outline</span>
            </div>
            <h3 class="text-2xl font-black text-slate-900 dark:text-white">The Marketplace is opening soon!</h3>
            <p class="text-slate-500 max-w-md mx-auto mt-4">We are currently vetting our first set of platform partners. Check back shortly to discover amazing integrations.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Developer CTA -->
    <div class="bg-slate-900 rounded-3xl p-12 text-center text-white relative overflow-hidden">
        <h3 class="text-3xl font-black mb-4 relative z-10">Are you a Developer?</h3>
        <p class="text-slate-400 max-w-xl mx-auto mb-8 relative z-10">
            Build your own apps for the Puxbay platform and reach thousands of merchants. Access our robust APIs and Webhooks to create the next big thing.
        </p>
        <a href="{% url 'developer_settings' %}" class="inline-flex items-center gap-2 px-8 py-4 bg-white text-slate-900 rounded-2xl font-black transition-all hover:scale-105 hover:bg-indigo-50 relative z-10">
            Get Developer Keys
            <span class="material-symbols-outlined">api</span>
        </a>
        
        <!-- Decorative Background Icon -->
        <span class="absolute -bottom-10 -right-10 material-symbols-outlined text-[200px] opacity-10">terminal</span>
    </div>
</div>
{% endblock %}
