{% extends 'base.html' %}
{% load static %}

{% block title %}Pricing Plans - Simple & Transparent{% endblock %}

{% block content %}
<div id="pricing-page">
    <!-- Hero Section with Gradient -->
    <div class="relative bg-white overflow-hidden border-b border-slate-100">
        <div class="absolute inset-x-0 bottom-0 h-1/2 bg-slate-50/50"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-24 lg:pt-24 text-center relative z-10">
             <div class="mx-auto max-w-4xl">
                <h1 class="text-4xl tracking-tight font-extrabold text-slate-900 sm:text-5xl md:text-6xl mb-6">
                    <span class="block">Pricing plans for teams of</span>
                    <span class="block text-blue-600">all sizes</span>
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-xl text-slate-500">
                    Choose the perfect plan for your business. All plans include our award-winning support and 99.9% uptime guarantee.
                </p>
                
                <!-- Billing & Currency Toggle -->
                <div class="mt-10 flex flex-col sm:flex-row items-center justify-center gap-6">
                    <!-- Billing Cycle -->
                    <div class="relative bg-slate-100 p-1 rounded-xl flex items-center">
                        <button type="button" id="btn-monthly"
                                class="relative w-32 rounded-lg py-2 text-sm font-semibold whitespace-nowrap focus:outline-none transition-all duration-200 bg-white shadow-sm text-slate-900">
                            Monthly
                        </button>
                        <button type="button" id="btn-yearly"
                                class="relative w-32 rounded-lg py-2 text-sm font-semibold whitespace-nowrap focus:outline-none transition-all duration-200 flex items-center justify-center gap-2 text-slate-500 hover:text-slate-900">
                            Yearly <span class="text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded-full font-bold">-20%</span>
                        </button>
                    </div>

                    <!-- Currency Toggle -->
                    <div class="inline-flex p-1 bg-slate-100 mt-4 rounded-xl">
                        <button data-currency-switch="USD" class="px-6 py-2 rounded-lg text-sm font-bold transition-all duration-200 {% if active_currency == 'USD' %}bg-white text-blue-600 shadow-sm{% else %}text-slate-600 hover:text-slate-900{% endif %}">
                            $ USD
                        </button>
                        <button data-currency-switch="GHS" class="px-6 py-2 rounded-lg text-sm font-bold transition-all duration-200 {% if active_currency == 'GHS' %}bg-white text-blue-600 shadow-sm{% else %}text-slate-600 hover:text-slate-900{% endif %}">
                            GH₵ GHS
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pricing Cards -->
    <div class="bg-slate-50 py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid gap-8 lg:grid-cols-3 lg:gap-8 max-w-lg lg:max-w-none mx-auto">
                {% if plans %}
                    {% for plan in plans %}
                    <div class="flex flex-col rounded-2xl bg-white transition-all duration-300 transform hover:-translate-y-1 relative"
                         :class="'{{ plan.is_popular }}' === 'True' ? 'shadow-2xl border-2 border-blue-600 scale-105 z-10' : 'shadow-xl border border-slate-100'">
                        
                        {% if plan.is_popular %}
                        <div class="absolute top-0 inset-x-0 -mt-px transform -translate-y-1/2 flex justify-center">
                            <span class="inline-flex rounded-full bg-blue-600 px-4 py-1 text-sm font-bold tracking-wider uppercase text-white shadow-lg ring-4 ring-slate-50">
                                Most Popular
                            </span>
                        </div>
                        {% endif %}

                        <div class="p-8 pb-4">
                            <h3 class="text-xl font-bold text-slate-900">{{ plan.name }}</h3>
                            <p class="mt-4 text-sm text-slate-500 leading-relaxed min-h-[40px]">{{ plan.description }}</p>
                            <div class="mt-8 flex items-baseline">
                                <span class="text-5xl font-extrabold text-slate-900 tracking-tight transition-all duration-300 plan-price" 
                                      data-monthly="{% if active_currency == 'GHS' %}GH₵{{ plan.price_ghs|floatformat:0 }}{% else %}${{ plan.price|floatformat:0 }}{% endif %}"
                                      data-yearly="{% if active_currency == 'GHS' %}GH₵{{ plan.price_ghs|multiply:10|floatformat:0 }}{% else %}${{ plan.price|multiply:10|floatformat:0 }}{% endif %}">
                                    {% if active_currency == 'GHS' %}GH₵{{ plan.price_ghs|floatformat:0 }}{% else %}${{ plan.price|floatformat:0 }}{% endif %}
                                </span>
                                <span class="ml-1 text-xl font-medium text-slate-500 self-end mb-1 plan-cycle">/mo</span>
                            </div>
                            <p class="mt-1 text-xs text-slate-400 billed-yearly-msg hidden">Billed yearly</p>
                        </div>

                        <div class="flex-1 flex flex-col justify-between p-8 pt-0">
                            <div class="border-t border-slate-100 pt-6"></div>
                            <ul role="list" class="space-y-4 mb-8">
                                {% for feature in plan.features.all %}
                                <li class="flex items-start">
                                    {% if feature.is_available %}
                                    <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                                        <svg class="w-3 h-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
                                    </div>
                                    <span class="ml-3 text-sm text-slate-700 font-medium">{{ feature.text }}</span>
                                    {% else %}
                                    <div class="flex-shrink-0 w-5 h-5 rounded-full bg-slate-100 flex items-center justify-center mt-0.5">
                                         <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"/></svg>
                                    </div>
                                    <span class="ml-3 text-sm text-slate-400 line-through">{{ feature.text }}</span>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            
                            <a href="{% url 'signup' %}" 
                               class="block w-full rounded-xl py-3.5 text-sm font-bold text-center transition-all duration-200 transform active:scale-[0.98] {% if plan.is_popular %}bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-blue-200{% else %}bg-white border-2 border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50{% endif %}">
                                {{ plan.button_text|default:"Get Started" }}
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="col-span-3 text-center py-12">
                         <div class="inline-block p-4 rounded-full bg-slate-100 mb-4">
                            <svg class="w-8 h-8 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
                         </div>
                        <h3 class="text-lg font-medium text-slate-900">No Plans Available</h3>
                        <p class="text-slate-500 mt-1">Check back soon for our pricing options.</p>
                         <p class="text-xs text-slate-400 mt-4">(Admin: Please add plans in the dashboard)</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- FAQ Section -->
<div class="bg-white py-16 lg:py-24 border-t border-slate-100">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-extrabold text-slate-900 text-center mb-4">Frequently Asked Questions</h2>
        <p class="text-center text-slate-500 mb-12">Everything you need to know about the product and billing.</p>
        
        <div class="space-y-4" id="faq-accordion">
            {% for faq in faqs %}
            <!-- FAQ Item {{ forloop.counter }} -->
            <div class="border border-slate-200 rounded-lg bg-gray-50 overflow-hidden faq-item">
                <button type="button" class="faq-btn flex justify-between items-center w-full px-6 py-4 text-left focus:outline-none bg-white hover:bg-gray-50 transition-colors">
                    <span class="text-lg font-medium text-slate-900">{{ faq.question }}</span>
                    <svg class="w-5 h-5 text-slate-500 transform transition-transform duration-200 faq-icon" 
                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>
                <div class="px-6 py-4 border-t border-slate-200 text-slate-600 bg-white faq-content hidden">
                    {{ faq.answer }}
                </div>
            </div>
            {% empty %}
            <p class="text-center text-slate-500">No FAQs available at the moment.</p>
            {% endfor %}
        </div>
    </div>
</div>

<script nonce="{{ request.csp_nonce }}" src="https://js.paystack.co/v1/inline.js"></script>
<script nonce="{{ request.csp_nonce }}">
    document.addEventListener('DOMContentLoaded', () => {
        // Pricing Toggles
        const btnMonthly = document.getElementById('btn-monthly');
        const btnYearly = document.getElementById('btn-yearly');
        const prices = document.querySelectorAll('.plan-price');
        const cycles = document.querySelectorAll('.plan-cycle');
        const yearlyMsgs = document.querySelectorAll('.billed-yearly-msg');
        const payBtns = document.querySelectorAll('.plan-pay-btn');
        let billingInterval = 'monthly';

        function updatePricing(interval) {
            billingInterval = interval;
            
            // Toggle Buttons
            if (interval === 'monthly') {
                btnMonthly.classList.add('bg-white', 'shadow-sm', 'text-slate-900');
                btnMonthly.classList.remove('text-slate-500', 'hover:text-slate-900');
                
                btnYearly.classList.remove('bg-white', 'shadow-sm', 'text-slate-900');
                btnYearly.classList.add('text-slate-500', 'hover:text-slate-900');
            } else {
                btnYearly.classList.add('bg-white', 'shadow-sm', 'text-slate-900');
                btnYearly.classList.remove('text-slate-500', 'hover:text-slate-900');
                
                btnMonthly.classList.remove('bg-white', 'shadow-sm', 'text-slate-900');
                btnMonthly.classList.add('text-slate-500', 'hover:text-slate-900');
            }

            // Update Prices
            prices.forEach(el => {
                el.textContent = interval === 'monthly' ? el.dataset.monthly : el.dataset.yearly;
            });

            // Update Cycle
            cycles.forEach(el => {
                el.textContent = interval === 'monthly' ? '/mo' : '/yr';
            });

            // Update Disclaimer
            yearlyMsgs.forEach(el => {
               if (interval === 'yearly') el.classList.remove('hidden');
               else el.classList.add('hidden');
            });
        }

        if (btnMonthly && btnYearly) {
            btnMonthly.addEventListener('click', () => updatePricing('monthly'));
            btnYearly.addEventListener('click', () => updatePricing('yearly'));
        }

        // FAQ Accordion
        const faqBtns = document.querySelectorAll('.faq-btn');
        faqBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const content = btn.nextElementSibling;
                const icon = btn.querySelector('.faq-icon');
                
                // Close others? Or allow multiple? 
                // Alpine version allowed only one? "activeAccordion = ... ? null : index".
                // Yes, only one.
                
                // Check if currently open
                const isOpen = !content.classList.contains('hidden');

                // Close all
                document.querySelectorAll('.faq-content').forEach(c => c.classList.add('hidden'));
                document.querySelectorAll('.faq-icon').forEach(i => i.classList.remove('rotate-180'));

                if (!isOpen) {
                    content.classList.remove('hidden');
                    icon.classList.add('rotate-180');
                }
            });
        });
    });

    function updatePageCurrency(currency) {
        fetch('{% url "set_currency" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ currency: currency })
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'ok') {
                window.location.reload();
            }
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('[data-currency-switch]').forEach(btn => {
            btn.addEventListener('click', function() {
                const currency = this.getAttribute('data-currency-switch');
                if (currency) updatePageCurrency(currency);
            });
        });
    });
</script>
{% endblock %}
