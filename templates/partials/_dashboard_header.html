{% load static %}
{# Dashboard Header/Navbar - Extracted from dashboard_base.html #}

<header class="bg-white border-b border-slate-200 h-16 fixed top-0 left-0 right-0 z-40 lg:pl-64 transition-all duration-300 dark:bg-slate-800 dark:border-slate-700">
    <div class="h-full px-4 sm:px-6 lg:px-8 flex items-center justify-between">
        <!-- Left: Mobile Toggle & Title -->
        <div class="flex items-center gap-4">
            <button id="sidebar-toggle-btn" class="lg:hidden p-2 -ml-2 text-slate-500 hover:text-slate-700 rounded-md dark:text-slate-400 dark:hover:text-slate-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>
            <h1 class="text-xl font-semibold text-slate-800 hidden sm:block dark:text-white">
                {% block page_title %}Dashboard{% endblock %}
            </h1>
        </div>

        <!-- Right: Actions -->
        <div class="flex items-center gap-4">
            <!-- Developer Settings -->
            {% if request.user.profile.role == 'admin' %}
            <a href="{% url 'developer_settings' %}" class="p-2 text-slate-500 hover:text-slate-700 rounded-full transition-colors dark:text-slate-400 dark:hover:text-white group relative" title="Developer Settings">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
                <span id="sandbox-indicator" class="{% if not user.profile.tenant.is_sandbox %}hidden{% endif %} absolute top-2 right-2 w-2 h-2 bg-amber-500 rounded-full border border-white dark:border-slate-800"></span>
            </a>
            {% endif %}

            <!-- Dark Mode Toggle -->
            <button id="dark-mode-toggle" class="p-2 text-slate-500 hover:text-slate-700 rounded-full transition-colors dark:text-slate-400 dark:hover:text-white focus:outline-none">
                <svg id="icon-sun" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
                <svg id="icon-moon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
            </button>

            <!-- Action Buttons Block -->
            {% block action_buttons %}{% endblock %}

            <!-- Network Status -->
            <div id="network-status" class="flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium"></div>
            
            <!-- Sync Status -->
            <div id="sync-status" class="hidden items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 rounded-full text-xs font-medium">
                <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span id="sync-count">Syncing...</span>
            </div>
            
            <!-- Queue Status -->
            <div id="queue-status" class="hidden items-center gap-2 px-3 py-1.5 bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300 rounded-full text-xs font-medium">
                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span id="queue-count">0 pending</span>
            </div>
            
            <!-- Notifications Dropdown -->
            <div class="relative">
                <button id="notification-btn" class="p-2 text-slate-400 hover:text-slate-600 transition-colors relative">
                    {% if unread_notification_count > 0 %}
                    <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border border-white"></span>
                    {% endif %}
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/></svg>
                </button>

                <div id="notification-dropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5 dark:bg-slate-800 dark:ring-slate-700" style="display: none;">
                    <div class="px-4 py-2 border-b border-gray-100 dark:border-slate-700 flex justify-between items-center">
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-white">Notifications</h3>
                        {% if unread_notification_count > 0 %}
                        <button id="dropdown-mark-all-read" class="text-xs text-indigo-600 hover:text-indigo-500">Mark all read</button>
                        {% endif %}
                    </div>
                    <div class="max-h-64 overflow-y-auto">
                        {% if latest_notifications %}
                            {% for notification in latest_notifications %}
                            <div class="px-4 py-3 hover:bg-gray-50 dark:hover:bg-slate-700 transition duration-150 ease-in-out border-b border-gray-100 dark:border-slate-700 last:border-0 relative {% if not notification.is_read %}bg-blue-50 dark:bg-slate-700/50{% endif %}">
                                <p class="text-sm text-gray-900 dark:text-white {% if not notification.is_read %}font-semibold{% endif %}">
                                    {{ notification.message|truncatechars:60 }}
                                </p>
                                <p class="text-xs text-gray-500 dark:text-slate-400 mt-1">{{ notification.created_at|timesince }} ago</p>
                                {% if notification.link %}
                                <a href="{{ notification.link }}" class="absolute inset-0 z-10"></a>
                                {% endif %}
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="px-4 py-3 text-center text-sm text-gray-500 dark:text-slate-400">
                                No new notifications
                            </div>
                        {% endif %}
                    </div>
                    <div class="px-4 py-2 border-t border-gray-100 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 text-center">
                        <a href="{% url 'notifications:list' %}" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">View all notifications</a>
                    </div>
                </div>
            </div>

            <!-- User Info -->
            <div class="flex items-center gap-3 pl-4 border-l border-slate-200">
                <div class="text-right hidden md:block">
                    <p class="text-sm font-medium text-slate-700">{{ user.username }}</p>
                    <p class="text-xs text-slate-500">{{ user.profile.role|title }}</p>
                </div>
                <div class="h-9 w-9 bg-blue-100 rounded-full flex items-center justify-center text-blue-700 font-bold border border-blue-200">
                    {{ user.username|make_list|first|upper }}
                </div>
            </div>
        </div>
    </div>
</header>
