{% extends 'wallet/base.html' %}

{% block content %}
<div class="space-y-6 animate-fade-in">
    <!-- Points Card -->
    <div class="glass-card p-6 relative overflow-hidden">
        <div class="absolute -right-6 -top-6 w-32 h-32 premium-gradient opacity-20 blur-3xl rounded-full"></div>
        <div class="flex justify-between items-start mb-8">
            <div>
                <p class="text-slate-400 text-sm font-medium uppercase tracking-wider mb-1">Available Points</p>
                <h3 class="text-4xl font-bold">{{ customer.loyalty_points|floatformat:0 }}</h3>
            </div>
            <div class="w-12 h-12 bg-white/5 rounded-xl flex items-center justify-center border border-white/10">
                <span class="material-icons-round text-indigo-400">stars</span>
            </div>
        </div>
        
        <div class="flex gap-4">
            <div class="flex-1 bg-white/5 rounded-2xl p-4 border border-white/5">
                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-tighter mb-1">Store Credit</p>
                <p class="text-lg font-bold">${{ customer.store_credit_balance }}</p>
            </div>
            <div class="flex-1 bg-white/5 rounded-2xl p-4 border border-white/5">
                <p class="text-slate-500 text-[10px] uppercase font-bold tracking-tighter mb-1">Total Spent</p>
                <p class="text-lg font-bold">${{ customer.total_spend }}</p>
            </div>
        </div>
    </div>

    <!-- Active Gift Cards -->
    {% if gift_cards %}
    <section>
        <div class="flex justify-between items-center mb-4">
            <h4 class="text-lg font-bold">My Gift Cards</h4>
            <span class="text-xs text-indigo-400 font-medium">View All</span>
        </div>
        <div class="flex gap-4 overflow-x-auto pb-4 -mx-2 px-2 no-scrollbar">
            {% for card in gift_cards %}
            <div class="min-w-[280px] h-44 premium-gradient rounded-3xl p-6 relative shadow-2xl shadow-indigo-500/10 flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <span class="material-icons-round text-white/50">contactless</span>
                    <p class="text-xs font-mono tracking-widest text-white/80">**** {{ card.code|slice:"-4:" }}</p>
                </div>
                <div>
                    <p class="text-white/60 text-[10px] uppercase tracking-widest font-bold mb-1">Balance</p>
                    <h5 class="text-3xl font-bold text-white">${{ card.balance }}</h5>
                </div>
                <div class="absolute right-0 bottom-0 p-4 opacity-10">
                    <span class="material-icons-round text-8xl">card_giftcard</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Recent Activity -->
    <section>
        <h4 class="text-lg font-bold mb-4">Recent Activity</h4>
        <div class="glass-card divide-y divide-white/5 overflow-hidden">
            {% for item in loyalty_history %}
            <div class="p-4 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center 
                        {% if item.transaction_type == 'earn' %}bg-green-500/10 text-green-400{% elif item.transaction_type == 'redeem' %}bg-red-500/10 text-red-400{% else %}bg-blue-500/10 text-blue-400{% endif %}">
                        <span class="material-icons-round text-xl">
                            {% if item.transaction_type == 'earn' %}add_circle{% elif item.transaction_type == 'redeem' %}remove_circle{% else %}swap_horiz{% endif %}
                        </span>
                    </div>
                    <div>
                        <p class="text-sm font-bold">{{ item.description|default:"Points updated" }}</p>
                        <p class="text-[10px] text-slate-500">{{ item.created_at|date:"M d, Y" }}</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm font-bold {% if item.points > 0 %}text-green-400{% else %}text-red-400{% endif %}">
                        {% if item.points > 0 %}+{% endif %}{{ item.points|floatformat:0 }}
                    </p>
                </div>
            </div>
            {% empty %}
            <div class="p-8 text-center text-slate-500">
                <span class="material-icons-round text-4xl mb-2">history</span>
                <p class="text-sm">No recent loyalty activity found.</p>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Recent Support/Orders -->
    <section>
        <h4 class="text-lg font-bold mb-4">Latest Receipts</h4>
        <div class="space-y-3">
            {% for order in recent_orders %}
            <div class="glass-card p-4 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center border border-white/5">
                        <span class="material-icons-round text-slate-400 text-xl">receipt_long</span>
                    </div>
                    <div>
                        <p class="text-sm font-bold">Order #{{ order.id|stringformat:".8s" }}</p>
                        <p class="text-[10px] text-slate-500">{{ order.created_at|date:"M d, Y" }}</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm font-bold">${{ order.total_amount }}</p>
                    <span class="text-[10px] px-2 py-0.5 rounded-full bg-green-500/10 text-green-400 border border-green-500/20">Success</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
</div>

<style>
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>
{% endblock %}
